"use strict";(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2076],{12076:(ct,D,t)=>{t.r(D),t.d(D,{CatalogGraphCard:()=>w});var f=t(8554),H=t(93006),Z=t(51491),O=t(92641),K=t(89173),Q=t(96671),M=t(51847),V=t(79692),j=t(19126),G=t.n(j),s=t(2784),X=t(73557),Y=t(52632),J=t(45327),U=t(21652),b=t(40718);const k=(0,V.Z)({card:({height:P})=>({display:"flex",flexDirection:"column",maxHeight:P,minHeight:P}),graph:{flex:1,minHeight:0}},{name:"PluginCatalogGraphCatalogGraphCard"}),w=P=>{const{variant:q="gridItem",relationPairs:_=U.v,maxDepth:$=1,unidirectional:W=!0,mergeRelations:B=!0,direction:F=b.N.LEFT_RIGHT,kinds:tt,relations:et,entityFilter:at,height:st,className:nt,rootEntityNames:ot,onNodeClick:it,title:e="Relations",zoom:n="enable-on-click"}=P,{entity:r}=(0,K.X2)(),d=(0,f.iB)(r),o=(0,Z.t)(Q.w),y=(0,Z.t)(Y.H),x=(0,X.s0)(),S=k({height:st}),E=(0,O.z)(),A=(0,s.useCallback)((l,v)=>{var R;const c=(0,f.of)(l.id),m=o({kind:c.kind.toLocaleLowerCase("en-US"),namespace:c.namespace.toLocaleLowerCase("en-US"),name:c.name});E.captureEvent("click",(R=l.entity.metadata.title)!=null?R:(0,M.$)(c),{attributes:{to:m}}),x(m)},[o,x,E]),g=G().stringify({rootEntityRefs:[(0,f.eE)(r)],maxDepth:$,unidirectional:W,mergeRelations:B,selectedKinds:tt,selectedRelations:et,direction:F},{arrayFormat:"brackets",addQueryPrefix:!0}),i=`${y()}${g}`;return s.createElement(H.r,{title:e,cardClassName:S.card,variant:q,noPadding:!0,deepLink:{title:"View graph",link:i}},s.createElement(J._,{...P,rootEntityNames:ot||d,onNodeClick:it||A,className:nt||S.graph,maxDepth:$,unidirectional:W,mergeRelations:B,direction:F,relationPairs:_,entityFilter:at,zoom:n}))}},45327:(ct,D,t)=>{t.d(D,{_:()=>it});var f=t(8554),H=t(65872),Z=t(43103),O=t(59274),K=t(5191),Q=t(4614),M=t(79692),V=t(60364),j=t(12524),G=t.n(j),s=t(2784),X=t(10368);const Y=(0,X.Z)(e=>({text:{fill:e.palette.textContrast},secondary:{fill:e.palette.textSubtle}}),{name:"PluginCatalogGraphCustomLabel"});function J({edge:{relations:e}}){const n=Y();return s.createElement("text",{className:n.text,textAnchor:"middle"},e.map((r,d)=>s.createElement("tspan",{key:r,className:G()(d%2!==0&&n.secondary)},d>0&&s.createElement("tspan",null," / "),r)))}var U=t(70666),b=t(51847),k=t(72379);function w({kind:e,...n}){var o;const d=(o=(0,U.q)().getSystemIcon(`kind:${e.toLocaleLowerCase("en-US")}`))!=null?o:k.Z;return s.createElement(d,{...n})}var P=t(24978);const q=(0,M.Z)(e=>({node:{fill:e.palette.grey[300],stroke:e.palette.grey[300],"&.primary":{fill:e.palette.primary.light,stroke:e.palette.primary.light},"&.secondary":{fill:e.palette.secondary.light,stroke:e.palette.secondary.light}},text:{fill:e.palette.getContrastText(e.palette.grey[300]),"&.primary":{fill:e.palette.primary.contrastText},"&.secondary":{fill:e.palette.secondary.contrastText},"&.focused":{fontWeight:"bold"}},clickable:{cursor:"pointer"}}),{name:"PluginCatalogGraphCustomNode"});function _({node:{id:e,entity:n,color:r="default",focused:d,onClick:o}}){const y=q(),[x,S]=(0,s.useState)(0),[E,A]=(0,s.useState)(0),g=(0,U.q)(),i=(0,s.useRef)(null);(0,s.useLayoutEffect)(()=>{if(i.current){let{height:N,width:C}=i.current.getBBox();N=Math.round(N),C=Math.round(C),(N!==E||C!==x)&&(S(C),A(N))}},[x,E]);const{kind:l,metadata:{name:v,namespace:c=P.zG,title:m}}=n,R=g.getSystemIcon(`kind:${l.toLocaleLowerCase("en-US")}`),h=10,L=E,z=R?L+h:0,p=z+x+h*2,u=E+h*2,a=m!=null?m:l&&v&&c?(0,b.$)({kind:l,name:v,namespace:c}):e;return s.createElement("g",{onClick:o,className:G()(o&&y.clickable)},s.createElement("rect",{className:G()(y.node,r==="primary"&&"primary",r==="secondary"&&"secondary"),width:p,height:u,rx:10}),R&&s.createElement(w,{kind:l,y:h,x:h,width:L,height:L,className:G()(y.text,d&&"focused",r==="primary"&&"primary",r==="secondary"&&"secondary")}),s.createElement("text",{ref:i,className:G()(y.text,d&&"focused",r==="primary"&&"primary",r==="secondary"&&"secondary"),y:u/2,x:z+(x+h*2)/2,textAnchor:"middle",alignmentBaseline:"middle"},a))}var $=t(21652),W=t(40718),B=t(98331),F=t(23200),tt=t(66088);function et(){const e=(0,O.h_)(F.A),n=(0,s.useRef)({requestedEntities:new Set,outstandingEntities:new Map,cachedEntities:new Map}),[r,d]=(0,s.useState)({}),o=(0,s.useCallback)(()=>{const{cachedEntities:g,requestedEntities:i}=n.current,l={};i.forEach(v=>{const c=g.get(v);c&&(l[v]=c)}),d(l)},[n,d]),[y,x]=(0,tt.Z)(async()=>{const{requestedEntities:g,cachedEntities:i}=n.current,l=Array.from(g).filter(c=>!i.has(c));if(l.length===0){o();return}const{items:v}=await e.getEntitiesByRefs({entityRefs:l});v.forEach(c=>{if(c){const m=(0,f.eE)(c);i.set(m,c)}}),o()},[n,o]),{loading:S,error:E}=y,A=(0,s.useCallback)(g=>{const i=new Set(g),{requestedEntities:l}=n.current;(i.size!==l.size||Array.from(i).some(v=>!l.has(v)))&&(n.current.requestedEntities=i,x(),o())},[n,x,o]);return{entities:r,loading:S,error:E,requestEntities:A}}var at=t(76635);function st({rootEntityRefs:e,filter:{maxDepth:n=Number.POSITIVE_INFINITY,relations:r,kinds:d,entityFilter:o}={}}){const{entities:y,loading:x,error:S,requestEntities:E}=et();return(0,s.useEffect)(()=>{const g=new Set([...e]),i=new Set;let l=[...e],v=0;for(;l.length>0&&(!isFinite(n)||v<n);){const c=l;for(l=[];c.length>0;){const m=c.shift(),R=y[m];if(i.add(m),R&&R.relations){if(o&&!o(R))continue;for(const h of R.relations)(!r||r.includes(h.type))&&(!d||d.some(L=>h.targetRef.startsWith(`${L.toLocaleLowerCase("en-US")}:`)))&&(i.has(h.targetRef)||(l.push(h.targetRef),g.add(h.targetRef)))}}++v}E([...g])},[y,e,n,r,d,o,E]),{entities:o?(0,at.pickBy)(y,(g,i)=>o(g)):y,loading:x,error:S}}function nt({rootEntityRefs:e,maxDepth:n=Number.POSITIVE_INFINITY,unidirectional:r=!0,mergeRelations:d=!0,kinds:o,relations:y,entityFilter:x,onNodeClick:S,relationPairs:E=$.v}){const[A,g]=(0,s.useState)({}),{entities:i,loading:l,error:v}=st({rootEntityRefs:e,filter:{maxDepth:n,kinds:o,relations:y,entityFilter:x}});return(0,B.Z)(()=>{var z;if(!i||Object.keys(i).length===0){g({});return}const c=Object.entries(i).map(([p,u])=>{const a=e.includes(p),N={id:p,entity:u,focused:a,color:a?"secondary":"primary",kind:u.kind,name:u.metadata.name,namespace:u.metadata.namespace||P.zG,title:u.metadata.title,spec:u.spec};return S&&(N.onClick=C=>S(N,C)),N}),m=[],R=new Set,h=[...e];for(;h.length>0;){const p=h.pop(),u=i[p];R.add(p),u&&((z=u==null?void 0:u.relations)==null||z.forEach(a=>{var N,C;if(i[a.targetRef]&&!(y&&!y.includes(a.type))&&!(o&&!o.some(I=>a.targetRef.startsWith(`${I.toLocaleLowerCase("en-US")}:`)))){if(!r||!R.has(a.targetRef))if(d){const I=(N=E.find(([rt,lt])=>rt===a.type||lt===a.type))!=null?N:[a.type],[T]=I;m.push({from:T===a.type?p:a.targetRef,to:T===a.type?a.targetRef:p,relations:I,label:"visible"})}else m.push({from:p,to:a.targetRef,relations:[a.type],label:"visible"});if(R.has(a.targetRef)||(h.push(a.targetRef),R.add(a.targetRef)),r){const I=m.findIndex(T=>p===T.from&&a.targetRef===T.to&&!T.relations.includes(a.type));if(I>=0)if(d){const T=(C=E.find(([rt,lt])=>rt===a.type||lt===a.type))!=null?C:[a.type];m[I].relations=[...m[I].relations,...T]}else m[I].relations=[...m[I].relations,a.type]}}}))}const L=m.reduce((p,u)=>{const a=p.findIndex(N=>N.from===u.from&&N.to===u.to);return a>=0?(p[a]={...p[a],relations:Array.from(new Set([...p[a].relations,...u.relations]))},p):[...p,u]},[]);g({nodes:c,edges:L})},100,[i,e,o,y,r,d,S,E]),{loading:l,error:v,...A}}const ot=(0,M.Z)(e=>({progress:{position:"absolute",left:"50%",top:"50%",marginLeft:"-20px",marginTop:"-20px"},container:{position:"relative",width:"100%",display:"flex",flexDirection:"column"},graph:{width:"100%",flex:1,"& path[marker-end]":{transition:"filter 0.1s ease-in-out"},"& path[marker-end]:hover":{filter:`drop-shadow(2px 2px 4px ${e.palette.primary.dark});`},"& g[data-testid=label]":{transition:"transform 0s"}}}),{name:"PluginCatalogGraphEntityRelationsGraph"}),it=e=>{const{rootEntityNames:n,maxDepth:r=2,unidirectional:d=!0,mergeRelations:o=!0,kinds:y,relations:x,entityFilter:S,direction:E=W.N.LEFT_RIGHT,onNodeClick:A,relationPairs:g=$.v,className:i,zoom:l="enabled",renderNode:v,renderLabel:c,curve:m,showArrowHeads:R}=e,h=(0,V.Z)(),L=ot(),z=(0,s.useMemo)(()=>(Array.isArray(n)?n:[n]).map(I=>(0,f.eE)(I)),[n]),p=(0,O.h_)(K.V),{loading:u,error:a,nodes:N,edges:C}=nt({rootEntityRefs:z,maxDepth:r,unidirectional:d,mergeRelations:o,kinds:y,relations:x,entityFilter:S,onNodeClick:A,relationPairs:g});return(0,s.useEffect)(()=>{a&&p.post(a)},[p,a]),s.createElement("div",{className:G()(L.container,i)},u&&s.createElement(Q.Z,{className:L.progress}),N&&C&&s.createElement(H.m,{nodes:N,edges:C,renderNode:v||_,renderLabel:c||J,direction:E,className:L.graph,paddingX:h.spacing(4),paddingY:h.spacing(4),labelPosition:Z.N.LabelPosition.RIGHT,labelOffset:h.spacing(1),zoom:l,curve:m,showArrowHeads:R}))}},21652:(ct,D,t)=>{t.d(D,{v:()=>H});var f=t(9277);const H=[[f.$1,f.S4],[f.Dg,f.X9],[f.Zj,f.M_],[f.aS,f.cz],[f._b,f.wP],[f.KS,f.hr],[f.nP,f.w$]]}}]);})();

//# sourceMappingURL=2076.e4b1bd70.chunk.js.map